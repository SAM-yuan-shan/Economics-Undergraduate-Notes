
# 互联网规模下的推荐系统与广告精准投放解析
## 导论：信息爆炸时代的挑战与机遇
> [!INFO] 核心问题
> 在互联网时代，信息量远远超过个人能够主动查看和处理的范围。用户主动表达的需求往往只是冰山一角。
- **现实背景**：我们面临的是非常现实的业务应用场景，尤其是在互联网规模下。
- **信息过载**：信息量巨大，用户难以主动筛选。
- **需求表达**：用户主动表达的需求有限，很多潜在需求未被发掘。
- **核心转变**：
    - 传统模式：人找信息 (用户主动搜索)
    - 现代模式：信息找人 (系统主动推荐)
        - **例子**：你打开购物App，首页会根据你的喜好展示商品，而不是等你搜索；短视频App会自动播放你可能感兴趣的视频。
## 推荐系统的核心理念与技术演进
### 1. 传统推荐方法
- **基于内容/规则**：早期系统可能依赖于一些明确的规则或内容的相似性。
    - **例子**：如果你买了一本关于“编程”的书，系统可能会推荐其他“编程”相关的书籍。
- **协同过滤 (早期)**：
    - “物以类聚，人以群分”。
    - **例子**：如果用户A和用户B都喜欢电影X和电影Y，那么当用户A喜欢了电影Z后，系统可能会把电影Z推荐给用户B。
### 2. 现代推荐系统：拥抱深度学习
> [!IMPORTANT] 关键目标
> 系统能够精准匹配用户需求和物品/信息，提高转化率和用户满意度。
#### 2.1. 用户-物品交互建模 (User-Item Interaction)
- **核心数据**：用户与物品（商品、视频、文章、广告等）之间的交互记录。
    - **例子**：用户A点击了商品B、用户C观看了视频D、用户E给文章F点了赞。
- **目标**：通过分析这些交互，理解用户的偏好和物品的特性。
- **方法**：
    - **矩阵分解 (Matrix Factorization)**：将用户和物品表示为低维向量，通过向量间的运算预测用户对未交互物品的兴趣。
        - **例子**：假设用户向量代表其对不同特征（如搞笑、动作、剧情）的偏好程度，物品向量代表其包含这些特征的程度。通过点积可以预测匹配度。
    - **构建用户画像与物品画像**：基于交互数据和元数据（如用户年龄、物品类别）生成详细的画像。
#### 2.2. 深度学习与表征学习 (Deep Learning & Representation Learning)
> [!TIP] 什么是表征学习？
> 将原始数据（如用户ID、物品ID、文本、图像）转换为计算机更容易理解和处理的数值向量（Embedding），这些向量能捕捉数据中的深层语义信息。
- **目标**：更深层次地理解用户行为，捕捉高阶、非线性的复杂关系。
- **优势**：大幅度提升对用户行为的理解能力。
- **例子**：
    - **用户观看行为**：用户观看了一系列视频，深度学习模型可以从这个序列中学习到用户兴趣的动态变化，而不仅仅是单个视频的偏好。
    - **协同行为中的深层模式**：不仅仅是“A和B都喜欢X”，而是能发现更复杂的模式，比如“喜欢A、B但不喜欢C的用户群体，通常也会喜欢D”。
#### 2.3. 双塔模型 (Two-Tower Model)
- **形象比喻**：“双方便面”（语音中的口误，应为“双塔模型”）。
- **架构**：
    - **用户塔 (User Tower)**：输入用户相关特征（如用户ID、历史行为序列、用户画像标签），输出用户Embedding向量。
    - **物品塔 (Item Tower)**：输入物品相关特征（如物品ID、物品属性、物品描述），输出物品Embedding向量。
- **匹配**：将用户Embedding和物品Embedding映射到同一个向量空间中。
- **相似度计算**：通过计算用户向量和物品向量之间的相似度（如点积、余弦相似度）来预测用户对物品的兴趣。
    - **例子**：如果用户“小明”的用户向量和物品“科幻电影A”的物品向量在空间中非常接近，则系统会认为小明可能喜欢这部电影。
- **应用场景**：召回（从海量物品中快速筛选出少量候选集）、排序（对候选集进行精准打分排序）。
![双塔模型示意图](https://www.researchgate.net/publication/350733409/figure/fig4/AS:1011351499010053@1618138996890/The-two-tower-model-architecture-The-left-tower-takes-user-features-as-input-and.png)
*(这是一个网络图片的例子，实际使用中你可以替换成自己的绘图)*
```mermaid
graph LR
    subgraph 用户塔 (User Tower)
        U_Features[用户特征 User Features] --> U_Net[用户侧网络 User Network] --> User_Embedding[用户Embedding]
    end
    subgraph 物品塔 (Item Tower)
        I_Features[物品特征 Item Features] --> I_Net[物品侧网络 Item Network] --> Item_Embedding[物品Embedding]
    end
    User_Embedding -- 相似度计算 (e.g., Dot Product) --> Prediction[预测结果 Prediction Score]
    Item_Embedding -- 相似度计算 --> Prediction
````
#### 2.4. 序列建模（Sequential Modeling）
> [!NOTE]核心思想用户的行为不是孤立的，而是具有相互性的。理解用户行为序列对于预测其未来行为至关重要。
- **背景**：“商城是叙述”（语音中的口误，应为“相互关系”或“序列”建模）。
- **与传统深度学习的区别**：传统深度学习模型可以独立处理每次交互，而序列模型会考虑交互的顺序和上下文。
- **代表技术**：
    - **RNN (Recurrent Neural Network)** / LSTM (Long Short Term Memory) / **GRU (Gated Recurrent Unit) ：****早期**用于序列建模。
    - **Transformer（引爆了大概率模型）**：近年来的主流模型，通过自注意力机制（Self-Attention）捕捉序列中不同位置之间的依赖关系，效果显着。
        - **例子**：用户依次点击了广告A -> 广告B -> 广告C。Transformer模型能够分析这个序列，理解用户兴趣的变化，并预测他接下来可能点击广告D。
- **应用**：
    - 行为序列建模：根据用户历史点击、购买、观看序列预测下一个行为。
    - **示例**：一个用户最近一周的行为是：搜索“运动鞋” -> 浏览“篮球鞋A” -> 购买“篮球袜B” -> 浏览“篮球C”。基于此的序列模型可以预测他接下来可能对“篮球护具D”感兴趣。
## 广告推荐场景下的具体应用
### 1. 场景定义
- **业务目标**：从海量广告库中，为用户挑选出他们最感兴趣、最可能点击的广告。
- **核心信号**：“用户点击广告”通常被视为用户对广告感兴趣的强烈信号（正反馈）。
### 2. 数据与建模
- **训练数据**：
    - 用户历史行为序列（User Historical Sequence）：用户过去点击/观看/购买的物品（广告）序列。
    - 用户画像数据。
    - 广告特征数据。
- **建模任务**：根据用户的历史行为序列，预测用户下一个会点击/交互的广告。
    - **例子**：
        - 输入：用户U的历史点击广告序列`[Ad1, Ad2, Ad3]`
        - 输出：用户预测你接下来最可能点击的广告是`Ad4`还是`Ad5`。
- **模型选择**：可以选择多个序列模型，如基于Transformer的模型。
### 3.评估指标与考量因素
> [!IMPORTANT]最终目标不仅要模型效果好，还要考虑实际部署的效率和成本。
#### 3.1. 策略效果评估（Effectiveness）
- **基本要求**：最终推荐给用户的必须是真实的、可投放的广告。
- **评估方法**：
    - **给出历史序列，预测下一个真实交互的广告**。
        - **例子**：
            - 用户A的历史交互广告是`[Adv_X, Adv_Y]`。
            - 真实情况：用户A接下来点击了`Adv_Z`。
            - 模型预测：模型推荐了`[Adv_Z, Adv_P, Adv_Q]`（按优先级排序）。
            - 评估：`Adv_Z`在模型的推荐列表中，且排名靠前，则模型效果好。
    - **常用指标**：
        - **点击率 (HR@K)**：预测的前K个结果中，有多少命中了用户真实点击的广告。
        - **NDCG@K (Normalized Discounted Cumulative Gain)**：不仅看是否命中，还看命中的广告排名是否靠前（越靠前越好）。
- **核心期望**：模型能够将用户后续真实交互的广告排在推荐列表的靠前的位置。
#### 3.2. 推理效率/性能（效率）
- **背景**：线上系统在短时间内对大量用户请求需要做出响应。
- **考量**：模型的计算复杂度、推理运行时间、资源消耗（CPU/GPU、内存）。
- **综合考虑**：“我们还会综合考虑推理当时的情况”。
#### 3.3. 最终评分机制（示例）
> [!EXAMPLE]评分构成（举例，具体权重会根据实际情况调整）
> 
> - **策略效果得分**：占，例如60%-70%（语音中提到“四周六”或“七乘式策略效果”）
> - **推理效率得分**：大约，例如30%-40%（语音中提到“三乘式推理效率”）
- **举例来说**：最终总分 =`策略效果分 * 0.7 + 推理效率分 * 0.3`
- **上线标准**：可能会有最低的推理时间限制，例如“电话本体之间限制”（语音口误，可能是指“单次推理时间长限制”或“序列长度限制”），如果超过这个限制，可能无法被采纳或低分。
### 4. 提交与格式要求（竞赛/项目背景）
- **输出内容**：
    - 针对给每个定的用户（或用户历史序列），输出其最可能感兴趣的**Top-K**个广告ID。
    - “输入一个数字输入机，输入固定出去”（可能是指输入用户ID/序列，输出固定数量K个广告ID）。
- **数量限制**：
    - “如果大于十个，冻结取钱时间”（语音口语，更合理的解释是：如果要求输出Top-10，而你输出了超过10个，则只取前10个；或者如果你的模型处理的序列长度超过某个，限制会有惩罚或中断）。
    - **重点**：需要严格按照要求的格式和数量提交结果。
- **举例**：
    - **输入**：用户`user123`的历史点击序列`[ad_A, ad_B]`
    - **要求**：预测Top-3广告
    - **你的输出（文件格式可能如下）**：
        ```
        user123,ad_C,ad_D,ad_E
        ```
        （表示该预测用户接下来最可能点击的是ad_C，其次是ad_D，再次是ad_E）
## 核心任务总结与展望
> [!SUCCESS] 赛题/核心项目目标基于用户历史行为序列数据，通过建模与推理，预测接下来用户感兴趣的广告，并兼顾模型的准确性和效率。
- **主要流程**：
    1. **数据理解与成本**：理解提供的用户行为序列数据、广告数据。
    2. **特征工程**：从原始数据中提取有用的特征。
    3. **模型选择与训练**：选择合适的序列推荐模型（如Transformer、SASRec、BERT4Rec等）进行训练。
    4. **推理与预测**：对给定的用户历史序列，预测其未来可能点击的广告。
    5. **结果评估与调优**：根据评估指标不断优化模型。
- **鼓励创新**：
    - 推荐系统领域发展迅速，从早期的方法到如今的深度学习、序列建模、图神经网络等。
    - “直接在支持空间上，在线模式呈现”（指基于嵌入的方法并且能够实时更新的模型）。
    - **建议**：充分调研学术界和工业界的最新研究成果（如百度等大厂在这方面有很多研究），并结合实际问题提出自己的想法和改进方案。
## 学习资料与方向(提示)
- **早期方法**：良好的过滤、矩阵分割（如SVD、FunkSVD）。
- **深度学习基础**：
    - **嵌入技术**：Word2Vec、Item2Vec。
    - **常见网络结构**：MLP、CNN、RNN、LSTM。
- **序列推荐模型**：
    - `GRU4Rec`
    - `SASRec`（自我关注的顺序推荐）
    - `BERT4Rec`（来自 Transformer 的双向编码器表示，供推荐使用）
    - `BST`（行为序列转换器）
- **双塔模型**及其变种。
- **图神经网络（GNN）**在推荐中的应用。
---
