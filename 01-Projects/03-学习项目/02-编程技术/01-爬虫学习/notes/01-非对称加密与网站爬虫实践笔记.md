# 01-非对称加密与网站爬虫实践笔记

## 课程内容概述

本节课主要学习了非对称加密在网络爬虫中的应用，以及如何通过分析和模拟加密过程来爬取需要登录的网站数据。

## 1. 非对称加密基础

### 1.1 非对称加密概念

非对称加密与对称加密的区别：
- 对称加密：加密和解密使用同一个密钥
- 非对称加密：加密和解密使用不同的密钥（一对密钥）
  - 公钥：用于加密，可以公开
  - 私钥：用于解密，需要保密

### 1.2 常见非对称加密算法

- RSA
- DSA

### 1.3 RSA加密原理

RSA加密过程可以用表达式表示：
- 密文 = 明文^e mod n
- 其中e和n组成公钥

RSA解密过程：
- 明文 = 密文^d mod n
- 其中d和n组成私钥

RSA密钥长度通常有：
- 512位（已不安全）
- 1024位
- 2048位（更安全）

## 2. 网站加密分析方法

### 2.1 寻找密钥文件的方式

1. 在JS文件中搜索：
   - 关键词：`RSA`、`gsintrept`、`setPublicKey`、`setKey`等
   - 示例：通过搜索`getPublicKey`找到公钥信息

2. 在网页源代码中搜索：
   - 直接检查网页源代码，查找`MII`开头的字符串（常见RSA公钥标识）

3. 通过API返回：
   - 有些网站会通过API动态返回公钥

### 2.2 加密流程分析步骤

1. 定位登录请求
2. 分析请求中的加密参数
3. 追踪加密参数的生成过程
4. 确定使用的加密算法
5. 提取必要的密钥和参数
6. 模拟加密过程

## 3. 实战案例分析

### 3.1 案例一：36氪网站登录

#### 分析过程：
1. 打开F12，观察登录请求
2. 发现密码被加密为一长串密文（RSA加密特征）
3. 搜索关键词找到`RSA.encrypt`相关代码
4. 提取公钥信息
5. 使用相同的加密方法模拟加密过程

#### 实现思路：
```python
# 1. 导入必要模块
import requests
from jsdom import JSDOM
# 或使用其他JS执行环境

# 2. 提取公钥
# 3. 使用公钥加密密码
# 4. 构造请求参数
# 5. 发送登录请求
```

### 3.2 案例二：房天下网站登录

#### 分析过程：
1. 网页源代码中发现公钥信息
2. 分析密码加密过程，使用SHA512先对密码进行哈希处理
3. 然后用RSA加密处理后的结果

#### 加密流程：
1. 使用SHA512对原始密码加密
2. 从后端获取公钥和item_2参数
3. 使用RSA对(item_2 + SHA512密码)进行加密

### 3.3 案例三：动态公钥网站

特点：网站在滑块验证后，由后端API返回不同的公钥和验证参数

流程：
1. 滑块验证后获取公钥和验证参数
2. 使用公钥对密码进行RSA加密
3. 提交加密后的数据进行登录
4. 获取token用于后续请求

## 4. 模拟实现技巧

### 4.1 JS代码提取与执行

提取网站JS代码的方法：
```python
# 提取网站JS代码
with open('extracted.js', 'r', encoding='utf-8') as f:
    js_code = f.read()

# 执行JS代码
# 使用execjs, js2py等库执行
```

### 4.2 加密模拟

```python
# RSA加密模拟
def rsa_encrypt(public_key, data):
    # 使用公钥加密数据
    # 返回加密后的数据
    pass

# SHA加密模拟
def sha_encrypt(data, algorithm='sha512'):
    # 返回哈希结果
    pass
```

### 4.3 请求构造

```python
# 构造登录请求
def login(username, password):
    # 获取公钥
    # 加密密码
    # 构造请求参数
    # 发送请求
    # 返回结果
    pass
```

## 5. 注意事项

1. 爬虫仅用于学习目的，应遵守相关法律法规
2. 模拟网站加密不是为了破解，而是为了理解网络通信过程
3. 爬取网站数据时应控制请求频率，避免对目标网站造成负担
4. 遵守网站robots.txt的规定
5. 不要泄露或滥用所获取的数据

## 6. 学习资源

1. Node-RSA库：用于RSA加密操作
2. CryptoJS：提供多种加密算法支持
3. JSEncrypt：用于网页中的RSA加密 