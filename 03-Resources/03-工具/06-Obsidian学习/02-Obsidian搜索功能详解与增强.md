# Obsidian 搜索功能详解与增强 (讲稿整理)

## 引言：库与搜索的重要性

- **库 (Vault)**：Obsidian 的核心概念，将所有相关笔记文件组织在一个目录下，便于统一管理和搜索。
- **搜索优势**：与在文件系统中搜索单个文件（如 Word 文档）不同，Obsidian 会对其库内的文件建立索引，实现高效、统一的全局搜索。
- **Obsidian 搜索定义**：自带搜索功能强大，但存在不足（更像过滤器而非智能排序），可通过插件弥补。

## Obsidian 内置搜索功能

### 搜索类型

1. **单一文件内搜索 (Find)**：
   - 快捷键 `Ctrl+F` / `Cmd+F` 或点击文件内搜索按钮
   - **不支持**正则表达式
   - 仅在当前打开的文件内进行简单文本搜索

2. **整库搜索 (Search)**：
   - 快捷键 `Ctrl+Shift+F` / `Cmd+Shift+F` 或点击左侧边栏搜索图标
   - 功能更强大，支持操作符、范围限定和正则表达式

### 整库搜索 - 基础操作符

- **空格**：代表 **AND** (与)，结果必须同时包含空格分隔的多个关键词
  - 示例：`obsidian vika` (同时包含 obsidian 和 vika)
- **`OR` (大写)**：代表 **OR** (或)，结果包含任一关键词即可
  - 示例：`obsidian OR vika` (包含 obsidian 或 vika)
  - 注意：小写的 `or` 会被视为普通关键词搜索
- **`-` (减号/连字符)**：代表 **NOT** (非)，排除包含特定关键词的结果
  - 示例：`obsidian -vika` (包含 obsidian 但不包含 vika)
- **`()` (小括号)**：调整 **优先级**，类似数学运算中的括号
  - 示例：`obsidian (vika OR text)` (必须包含 obsidian，且包含 vika 或 text)
  - 无括号时：`obsidian vika OR text` (包含 obsidian 和 vika，或者包含 text)

### 整库搜索 - 范围限定符 (Operators)

用于将搜索限制在笔记的特定区域。可以与关键词和基础操作符组合使用。

- `file:`：仅在 **文件名** 中搜索
  - 示例：`file:obsidian`
- `path:`：在 **文件路径** (包含文件夹名和文件名) 中搜索
  - 示例：`path:obsidian`
- `content:`：仅在 **文件内容** 中搜索 (不包括文件名和路径)
  - 示例：`content:obsidian`
  - (默认不加限定符时，会同时搜索文件名、路径和内容)
- `line:`：在 **单行内** 搜索，要求关键词出现在同一行
  - 示例：`line:(obsidian vika)`
- `block:`：在一个 **区块 (Block)** 内搜索。列表的每一项、段落等都可视为区块
- `section:`：在一个 **章节 (Section)** 内搜索，指两个标题之间的内容
- `task:`：搜索 **待办事项 (Task)**
  - 示例：`task:obsidian`
- `task-todo:`：仅搜索 **未完成** 的待办事项
- `task-done:`：仅搜索 **已完成** 的待办事项

**组合使用**：可以将范围限定符与 `OR` 等操作符组合
- 示例：`content:obsidian OR file:obsidian` (内容含 obsidian 或文件名含 obsidian)

### 整库搜索 - 其他功能

- **保存搜索 (Save Search)**：在搜索面板输入查询语句后，点击星标旁的放大镜图标，可以将当前搜索条件保存为书签（Starred Search），方便以后快速调用
- **区分大小写 (Match Case)**：通过开关控制是否区分关键词的大小写
- **显示上下文 (Explain Search Term)**：开关控制是否在结果中显示匹配项周围的上下文
- **折叠/展开结果 (Collapse/Expand Results)**：控制搜索结果列表的显示方式
- **排序 (Sort Order)**：
  - 默认按文件名 A-Z 排序 (因此 `@` 等特殊符号开头的笔记会靠前)
  - 可选：文件名 Z-A、编辑时间 (新->旧 / 旧->新)、创建时间 (新->旧 / 旧->新)
- **复制搜索结果 (Copy Search Results)**：可以将搜索结果列表复制出来，可选格式（Wiki 链接/Markdown 链接）、是否包含路径等

### 整库搜索 - 正则表达式 (Regular Expressions)

- **语法**：将正则表达式语句用 `/` 包裹
  - 示例：`/regex_pattern/`
- **组合使用**：可以与范围限定符结合
  - 示例：`file:/^\d{4}-\d{2}-\d{2}/` (搜索文件名以 YYYY-MM-DD 日期格式开头的笔记)
  - 示例：`line:/\d+/` (搜索包含数字的行)
  - 示例：`-line:/\d+/` (排除包含数字的行)
- **引擎**：Obsidian 使用 JavaScript 风格的正则表达式
- **应用**：利用正则可以实现更灵活、更强大的模式匹配搜索

### 内置搜索的局限性："过滤"而非"搜索"

- **核心问题**：Obsidian 内置搜索更像是 **过滤器 (Filter)**，它找出所有符合条件的笔记，但排序方式非常机械（按文件名、时间等），缺乏 **相关性排序 (Relevance Ranking)**
- **用户痛点**：当笔记数量庞大时，即使过滤后结果很多，也难以快速找到 **最相关、最想要** 的那篇笔记
- **对比**：真正的搜索引擎（如 Google）会通过算法评估页面与查询的相关性，将最相关的结果排在前面

## Omni Search 插件：智能相关性搜索

### 核心目标

- 解决内置搜索缺乏相关性排序的问题
- 通过 **加权评分算法**，将最可能相关的笔记排在搜索结果前面

### 主要特性

1. **相关性排序算法 (Weighting)**：
   - **默认权重 (可调)**：
     - 文件名 (Filename) / 声明的别名 (Declared Alias): 权重 3 (最高)
     - 文件路径 (Path): 权重 2
     - H1 标题: 权重 1.5
     - H2 标题: 权重 1.3
     - H3 标题: 权重 1.1
     - (标签等其他权重可在设置中查看)
   - **意义**：包含关键词的笔记，若关键词出现在文件名、别名或高级别标题中，其相关性得分更高，排名更靠前
   - **启示**：**规范化笔记结构** (写好标题、用好别名) 对提升 Omni Search 效果至关重要

2. **扩展搜索范围**：
   - 除了 Markdown (`.md`) 文件，还可以配置搜索其他纯文本文件 (如 `.txt`, `.css`, `.js` 等)
   - **需要额外插件**：通过安装 Helper 插件 (如 Text Extractor)，可以索引并搜索 PDF 文件和图片中的文字 (OCR)。(注意：中文 OCR 效果可能需要测试)

3. **搜索界面与交互**：
   - 命令面板 (`Ctrl+P`) 或快捷键 (`Ctrl+Shift+O` 默认？需检查) 打开 Omni Search 搜索框
   - **整库搜索 (Vault Search)** vs **当前文件搜索 (In-file Search)**
   - **Tab 键钻取搜索**：
     - 在整库搜索结果列表中，选中一篇笔记
     - 按 `Tab` 键，可以 **进入该笔记内部** 继续搜索或浏览匹配项
     - 再次按 `Tab` 键，可以返回上一层（整库搜索结果列表）
   - **插入链接 (`Alt+Enter` / `Option+Enter`)**：
     - 在搜索结果列表中选中一篇笔记
     - 按 `Alt+Enter` (Windows) 或 `Option+Enter` (Mac)，可以将该笔记的链接直接插入到当前光标位置
     - 优势：可以通过 **内容** 搜索找到笔记并快速插入链接，而不仅仅是依赖文件名/别名

4. **中文支持**：
   - **重要**：为了获得更好的中文搜索效果（正确分词），强烈建议安装 **`Obsidian Word Splitting Plugin for Chinese`** 插件
   - Omni Search 会利用这个插件的分词结果进行索引和搜索

### Omni Search 设置建议

- **权重**：通常保持默认权重即可，已经比较合理
- **性能**：根据库大小调整索引设置
- **界面**：根据喜好调整摘要显示等

## Quick Switcher++ 插件：高效导航与上下文搜索

### 核心目标

- 提供比 Obsidian 内置 Quick Switcher (`Ctrl+O`) 更强大的快速导航和上下文感知搜索功能

### 主要特性 (通过特殊符号触发不同搜索模式)

1. **标准模式 (Standard Mode)**：类似内置 `Ctrl+O`，主要通过文件名和别名搜索笔记
2. **标题搜索 (Heading Search)**：
   - 触发符：`#` (井号)
   - 用法：输入 `#` 后跟关键词，仅在所有笔记的 **标题** 中搜索
   - 示例：`#obsidian`

3. **符号搜索 (Symbol Search)**：
   - 触发符：`@`
   - 用法：
     - **全局符号搜索**：直接输入 `@` 搜索所有笔记的符号（不推荐，结果过多）
     - **当前文件符号搜索**：通过命令面板或快捷键打开，列出当前文件内所有标题、链接、嵌入、标签、Callout 等
     - **上下文符号搜索**：见下文"高级用法"

4. **相关项搜索 (Related Items Search)**：
   - 触发符：\` (反引号，Tab 键上方)
   - 用法：
     - **当前文件相关项**：通过命令面板打开，显示当前文件的反向链接、出链和同文件夹文件
     - **上下文相关项搜索**：见下文"高级用法"

5. **打开的编辑器/标签页搜索 (Editor Search)**：
   - 触发符：`edt ` (edt 加空格)
   - 用法：显示所有已打开的标签页，可快速过滤和切换

6. **命令搜索 (Command Search)**：
   - 触发符：`>`
   - 用法：搜索并执行 Obsidian 命令（等同于 `Ctrl+P`）

7. **工作区搜索 (Workspace Search)**：
   - 触发符：`+`
   - 用法：搜索并切换 Obsidian 工作区

8. **收藏搜索 (Starred Search)**：
   - 触发符：`*`
   - 用法：搜索已收藏的笔记或搜索条件