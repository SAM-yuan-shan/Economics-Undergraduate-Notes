# Obsidian 插件 Linter 与 Easy Typing 讲稿整理

## 引言与背景

*   **回顾**：正则表达式基础入门。
*   **痛点**：手动编写和维护 Markdown 格式比较繁琐，尤其是一些严格的语法要求（如空格、空行）。
*   **解决方案**：利用 Obsidian 插件自动化格式处理。
*   **历史插件**：`Markdown Prettier` 已被 `Linter` 取代。

## Linter 插件详解

### 核心功能

*   **定义**：Markdown 格式化工具，类似于编程语言中的 Linter。
*   **目的**：规范 Markdown 语法，减轻手动格式化的负担。
*   **重要性**：Markdown 依赖空格、空行等"隐形"字符作为边界，Linter 确保这些边界的正确性，保证渲染效果一致。

### 可格式化的内容

1.  **Front Matter (YAML/元数据区)**
    *   **基本规则**：冒号后加空格 (`key: value`)。
    *   **特殊字符处理**：当值包含特殊字符（如单引号）时，自动用双引号包裹；反之亦然 (例：`I'm Johnny` -> `title: "I'm Johnny"`）。
    *   **属性管理**：
        *   自动插入/更新属性：如 `aliases`, `tags` (在设置中配置需要自动插入的属性)。
        *   自动添加时间戳：`date created`, `date modified` (键名和日期格式 YYYY-MM-DD HH:mm:ss 等均可在设置中配置)。
    *   **别名设置**：可选择使用笔记的第一个 H1 标题或文件名作为别名。建议使用 H1 作为别名，与文件名区分（如文件名用时间戳，别名用有意义标题），便于查找。
    *   **属性排序**：可自定义 YAML 区域属性的显示顺序（在设置中按顺序填写 Key）。

2.  **正文内容 (Body)**
    *   **标题 (Headings)**：
        *   **层级规范**：自动修正标题层级，确保顺序递增 (H1 -> H2 -> H3...)。例如 `H1 -> H3 -> H5` 会被修正为 `H1 -> H2 -> H3`。
        *   **前后空行**：自动在标题前后添加空行，增强可读性和识别度。
    *   **段落 (Paragraphs)**：
        *   **多余空行处理**：移除连续的多个空行，最多只保留一个。
        *   **行尾空格**：处理行尾多余空格。
    *   **列表 (Lists)**：
        *   **样式统一**：将不同标记（`+`, `*`, `-`）的列表统一为指定样式（如全部用 `-`）。
        *   **缩进/空格**：处理列表项的缩进，可将多个空格转换成 Tab（或反之，并指定 Tab 等于几个空格）。
    *   **脚注 (Footnotes)**：批量移动和格式化脚注，例如可以将分散在文中的脚注定义统一移动到文末。
    *   **空格与空行 (Whitespace)**：全面处理文档中的空格和空行问题，确保符合规范。

### 应用范围

*   **整库 (Entire Vault)**：对库内所有符合条件的文件进行格式化（需谨慎使用，了解规则影响）。
*   **排除文件夹 (Excluded Folders)**：可以指定不应用 Linter 规则的文件夹。
*   **当前文件 (Current File)**：仅对当前打开的文件进行格式化。
*   **选中区域 (Selected Text)**：仅对选中的文本进行格式化。
*   **批量操作示例**：利用整库功能，给所有笔记批量添加某个 YAML 属性（如 `author: YourName`）。

### 触发方式

*   **手动命令 (Command Palette)**：执行 `Lint current file`, `Lint all files in vault` 等命令。
*   **保存时触发 (Lint on Save)**：在设置中开启，每次按 `Ctrl+S` / `Cmd+S` 保存文件时自动执行 Linter (需 Obsidian 保存快捷键未被修改)。
*   **粘贴时触发 (Format on Paste)**：在设置中开启，对从外部粘贴进来的文本自动进行格式化（如去除多余空行、格式化粘贴的列表/引用等）。

### 自定义与扩展

1.  **后续命令 (Run Commands After Lint)**：
    *   允许在 Linter 执行完毕后，自动触发另一个 Obsidian 命令。
    *   **示例**：Linter 格式化基础 -> Regex Pipeline 应用自定义复杂规则。
2.  **自定义正则替换 (Custom Regex Replacements)**：
    *   可以添加自定义的正则表达式查找和替换规则，在 Linter 执行时应用。
    *   **示例**：将 Markdown 图片链接 `[[Image.png]]` 统一转换为嵌入格式 `![[Image.png]]` (查找 `\[\[([^\]]+\.(?:png|jpg|jpeg|gif|bmp|svg))\]\]` 替换为 `!\[\[$1\]\]`)。注意正则中特殊字符需要转义。

### 设置与建议

*   **语言**：目前设置界面主要是英文。
*   **重要设置**：`Lint on save` 非常方便。YAML 相关设置（插入属性、时间戳格式）、空格空行规则（去除连续空行）、标题层级和空行、列表样式统一、粘贴时格式化等。
*   **文档**：设置项标题通常是可点击的链接，会跳转到 Linter 官方文档，有详细解释和前后对比示例。
*   **学习建议**：Linter 是 Obsidian **必装插件**。从常用设置开始，边用边学。遇到具体格式化需求时，可以在社区提问或查阅文档。

## Regex Pipeline 插件 (辅助 Linter)

*   **用途**：定义和执行一系列（管道）正则表达式规则，用于复杂的文本处理。
*   **集成**：常与 Linter 结合使用，通过 Linter 的 "Run Commands After Lint" 功能触发，实现 Linter 基础格式化 + 自定义高级格式化。
*   **规则管理**：
    *   规则集以 `.txt` 文件形式存储（推荐放在 `.obsidian/plugins/obsidian-regex-pipeline/rulesets/` 或其他指定位置）。
    *   需要在插件设置或指定文件 (`index.json`) 中注册规则集名称，才能在命令面板或右键菜单中找到。
*   **触发**：命令面板 (Apply rule set)、右键菜单 ("Quick Rule")。
*   **优点**：适合复杂、可重用的格式转换任务，规则易于分享。
*   **示例**：将 `1. Item One` / `2. Item Two` 格式的文本行批量转换为二级标题 `## Item One` / `## Item Two`。

## Easy Typing 插件详解

### 核心功能

*   **作者**：中国开发者，有 Bilibili 教程。
*   **定位**：侧重于**输入时**的编辑体验优化和自动格式化，尤其方便中文和 Markdown 符号输入。**实时生效**。

### 主要特性

1.  **智能符号处理 (Enhanced Pairing & Conversion)**
    *   **中文标点配对**：自动配对 `《》`, `【】` 等。
    *   **中英符号转换 (输入时)**：
        *   中文输入法下输入 `！！` 自动转为 `![]()` (用于嵌入图片/链接)。
        *   中文输入法下输入 `。。` 自动转为 ````` (行内代码)。
        *   中文输入法下**双击** `.` 自动转为英文 `.`。
        *   中文输入法下**双击** `!` 自动转为英文 `!`。

2.  **增强编辑 (Enhanced Editing Rules - 可自定义)**
    *   **选中文本规则**：
        *   **内置示例**：选中文字后按 `-`，自动添加删除线 (`~~text~~`)。
        *   **自定义示例**：选中文字后按 `|`，自动添加 Wiki 嵌入 (`![[text]]`)。
        *   **配置**：设置触发符号 (Trigger) 和左右添加的文本 (Left/Right)。
    *   **删除规则**：
        *   **内置示例**：光标在 `demo` 后按删除键，一次性删除整个单词 `demo`。
        *   **自定义示例**：光标在 Checklist (`- [ ] `) 后按删除键，自动转为普通列表项 (`- `)。
        *   **配置**：设置删除前文本模式 (Before)，用 `|` 标记光标位置，以及删除后文本 (After)，也用 `|` 标记光标。
    *   **转换/替换规则 (Text Expansion/Snippets)**：
        *   **内置示例**：输入 `:(` 自动转为 🙂。
        *   **强大应用**：实现文本片段快速输入。
            *   输入 `:ob|` 自动替换为 `Obsidian|` (光标在最后)。
            *   输入 `:con|` 自动插入 Note 类型的 Callout 模板 (支持多行)。
            *   输入 `:coi|` 自动插入 Info 类型的 Callout 模板 (支持多行)。
        *   **配置**：设置触发文本 (Trigger，含 `|` 光标) 和替换后文本 (After，含 `|` 光标)。

3.  **自动格式化 (Auto Formatting During Input)**
    *   **中英文间空格**：自动在中文和英文字符之间添加空格。
    *   **中文间空格处理**：自动移除中文字符之间的多余空格。
    *   **标点与空格**：中文标点前自动删除空格，英文标点则按常规处理。
    *   **首字母大写**：自动将行首或列表项首个英文字母大写（可在设置中开关，触发后可按 `Ctrl+Z` 撤销单次大写）。
    *   **标签格式化**：在中文后直接输入 `#标签`，自动在前面添加空格并使其被识别为标签 (通过自定义规则实现)。

4.  **自定义与排除**
    *   **自定义规则**：如上所述，可以添加自己的增强编辑规则（选中、删除、替换）。
    *   **排除规则**：可以指定哪些文件或文件夹不应用 Easy Typing 的规则。

### 与 Linter 对比

*   **触发时机**：Easy Typing 主要在**输入时**实时生效；Linter 主要在**保存时**或**手动执行命令**时对已有内容生效。
*   **侧重点**：Easy Typing 侧重提升**输入效率**和实时体验，特别是符号、中英文混合、片段输入；Linter 侧重对**已有内容**进行全面的格式规范化和校验。
*   **范围**：Linter 可作用于整库；Easy Typing 主要作用于当前编辑的上下文。
*   **建议**：两者功能互补，**推荐同时使用**。Linter 保证最终规范，Easy Typing 提升过程效率。

## 总结与建议

*   **Linter**：强大的格式化与规范校验工具，确保笔记一致性和正确性，**必装**。
*   **Easy Typing**：提升输入体验的利器，尤其适合中文用户和需要快速输入模板、符号、片段的场景。
*   **Regex Pipeline**：处理复杂、可分享的正则替换任务，可作为 Linter 的有力补充。
*   **学习方法**：结合使用这几个插件。从基础设置开始，边用边探索。遇到具体需求时，尝试自己配置或查阅文档、请教社区。
*   **Text Expansion 思考**：Easy Typing 的自定义转换规则本质上是一种文本扩展 (Text Expansion) 功能，类似于 Espanso、TextExpander 等工具。将其用好，可以定义大量常用短语、模板、链接、代码片段等的快捷输入方式，极大地提升笔记和写作效率。

